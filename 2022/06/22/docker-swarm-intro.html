<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>在 EC2 中開啟 Docker Swarm 群集 | Jacquelyn’s Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="在 EC2 中開啟 Docker Swarm 群集" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Docker Swarm Introduction Ref: (32) Docker Swarm Introduction - Video 28 - YouTube Structure Scalability &amp; Availability Differences/Definitions of Scalability &amp; Availability Scalability: 當流量變大/變小時，系統中的 server 數可以橫向擴展或縮減 Availability: 當部分的機器無法運作時，能夠確保服務不被中斷（自動開啟新的 instance） Docker Swarm Features Scalability：自動在空間足夠的 worker 上開啟新的 container Availability：以更新 app、降低 downtime 為例 當需要更新 app 版本時，可以讓 load balancer 自動 route 到新版 app 上 漸進式取代所有舊版的 app container Service vs Task 根據 document 的寫法，service 與 task 的差別如下圖： 兩者的區別在於，service 是由 manager 控管的 application，而 task 則是根據 manager 的控制、各個 worker 被指派的任務。 Stack vs Compose 基本上 stack 可以視為升級版的 compose，並且 stack 的設定檔也可以拿 docker-compose file 來執行（只要是 yml 都行） Swarm Mode Implementation Ref: Swarm与Docker的整合——Swarm mode - 知乎 (zhihu.com) Getting started with swarm mode, Docker Documentation → port prerequistive to set up security group Run docker daemon on EC2(amazon linux): Method 2: Assign Ownership to the Docker Unix Socket EC2 特殊設定 SSM53: session manager 參考前一篇文章 Security Group Inbounds Allow TCP port 6000-9000 from my IP Allow all TCP inbound from same security group，好處是可以不用特別設定 docker swarm 指定的傳輸 port 操作步驟 開三台 EC2，其中一台作為 manager、另外兩台作為 worker 安裝 docker 並執行 docker daemon 開啟 docker engine：sudo service docker start sudo chown ec2-user:docker /var/run/docker.sock （ec2-user為 user-name，給予 ec2-user docker engine 的 ownership） Manager 開啟一個 swarm、並將所在的機器指定為 manager：docker swarm init --advertise-addr [manager-ip] 終端機會回傳如何將 worker 加入 swarm 的指令：docker swarm join --token [token] [manager-ip]:2377 如果遺忘加入的指令的話，可以在 manager 下這個指令來找回：docker swarm join-token worker Worker 用生成的指令來加入剛剛設定的 swarm：docker swarm join --token [token] [manager-ip]:2377 檢查 swarm 元件 可以在 manager 下 docker node ls 檢查 swarm 內的節點是否符合預期" />
<meta property="og:description" content="Docker Swarm Introduction Ref: (32) Docker Swarm Introduction - Video 28 - YouTube Structure Scalability &amp; Availability Differences/Definitions of Scalability &amp; Availability Scalability: 當流量變大/變小時，系統中的 server 數可以橫向擴展或縮減 Availability: 當部分的機器無法運作時，能夠確保服務不被中斷（自動開啟新的 instance） Docker Swarm Features Scalability：自動在空間足夠的 worker 上開啟新的 container Availability：以更新 app、降低 downtime 為例 當需要更新 app 版本時，可以讓 load balancer 自動 route 到新版 app 上 漸進式取代所有舊版的 app container Service vs Task 根據 document 的寫法，service 與 task 的差別如下圖： 兩者的區別在於，service 是由 manager 控管的 application，而 task 則是根據 manager 的控制、各個 worker 被指派的任務。 Stack vs Compose 基本上 stack 可以視為升級版的 compose，並且 stack 的設定檔也可以拿 docker-compose file 來執行（只要是 yml 都行） Swarm Mode Implementation Ref: Swarm与Docker的整合——Swarm mode - 知乎 (zhihu.com) Getting started with swarm mode, Docker Documentation → port prerequistive to set up security group Run docker daemon on EC2(amazon linux): Method 2: Assign Ownership to the Docker Unix Socket EC2 特殊設定 SSM53: session manager 參考前一篇文章 Security Group Inbounds Allow TCP port 6000-9000 from my IP Allow all TCP inbound from same security group，好處是可以不用特別設定 docker swarm 指定的傳輸 port 操作步驟 開三台 EC2，其中一台作為 manager、另外兩台作為 worker 安裝 docker 並執行 docker daemon 開啟 docker engine：sudo service docker start sudo chown ec2-user:docker /var/run/docker.sock （ec2-user為 user-name，給予 ec2-user docker engine 的 ownership） Manager 開啟一個 swarm、並將所在的機器指定為 manager：docker swarm init --advertise-addr [manager-ip] 終端機會回傳如何將 worker 加入 swarm 的指令：docker swarm join --token [token] [manager-ip]:2377 如果遺忘加入的指令的話，可以在 manager 下這個指令來找回：docker swarm join-token worker Worker 用生成的指令來加入剛剛設定的 swarm：docker swarm join --token [token] [manager-ip]:2377 檢查 swarm 元件 可以在 manager 下 docker node ls 檢查 swarm 內的節點是否符合預期" />
<link rel="canonical" href="https://jqlynchien713.github.io/2022/06/22/docker-swarm-intro.html" />
<meta property="og:url" content="https://jqlynchien713.github.io/2022/06/22/docker-swarm-intro.html" />
<meta property="og:site_name" content="Jacquelyn’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-06-22T12:38:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="在 EC2 中開啟 Docker Swarm 群集" />
<script type="application/ld+json">
{"description":"Docker Swarm Introduction Ref: (32) Docker Swarm Introduction - Video 28 - YouTube Structure Scalability &amp; Availability Differences/Definitions of Scalability &amp; Availability Scalability: 當流量變大/變小時，系統中的 server 數可以橫向擴展或縮減 Availability: 當部分的機器無法運作時，能夠確保服務不被中斷（自動開啟新的 instance） Docker Swarm Features Scalability：自動在空間足夠的 worker 上開啟新的 container Availability：以更新 app、降低 downtime 為例 當需要更新 app 版本時，可以讓 load balancer 自動 route 到新版 app 上 漸進式取代所有舊版的 app container Service vs Task 根據 document 的寫法，service 與 task 的差別如下圖： 兩者的區別在於，service 是由 manager 控管的 application，而 task 則是根據 manager 的控制、各個 worker 被指派的任務。 Stack vs Compose 基本上 stack 可以視為升級版的 compose，並且 stack 的設定檔也可以拿 docker-compose file 來執行（只要是 yml 都行） Swarm Mode Implementation Ref: Swarm与Docker的整合——Swarm mode - 知乎 (zhihu.com) Getting started with swarm mode, Docker Documentation → port prerequistive to set up security group Run docker daemon on EC2(amazon linux): Method 2: Assign Ownership to the Docker Unix Socket EC2 特殊設定 SSM53: session manager 參考前一篇文章 Security Group Inbounds Allow TCP port 6000-9000 from my IP Allow all TCP inbound from same security group，好處是可以不用特別設定 docker swarm 指定的傳輸 port 操作步驟 開三台 EC2，其中一台作為 manager、另外兩台作為 worker 安裝 docker 並執行 docker daemon 開啟 docker engine：sudo service docker start sudo chown ec2-user:docker /var/run/docker.sock （ec2-user為 user-name，給予 ec2-user docker engine 的 ownership） Manager 開啟一個 swarm、並將所在的機器指定為 manager：docker swarm init --advertise-addr [manager-ip] 終端機會回傳如何將 worker 加入 swarm 的指令：docker swarm join --token [token] [manager-ip]:2377 如果遺忘加入的指令的話，可以在 manager 下這個指令來找回：docker swarm join-token worker Worker 用生成的指令來加入剛剛設定的 swarm：docker swarm join --token [token] [manager-ip]:2377 檢查 swarm 元件 可以在 manager 下 docker node ls 檢查 swarm 內的節點是否符合預期","url":"https://jqlynchien713.github.io/2022/06/22/docker-swarm-intro.html","headline":"在 EC2 中開啟 Docker Swarm 群集","@type":"BlogPosting","dateModified":"2022-06-22T12:38:00+00:00","datePublished":"2022-06-22T12:38:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jqlynchien713.github.io/2022/06/22/docker-swarm-intro.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
  <link rel="shortcut icon" type="image/png" href="/favicon.png"><link type="application/atom+xml" rel="alternate" href="https://jqlynchien713.github.io/feed.xml" title="Jacquelyn's Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Jacquelyn&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/tags/">Tags</a><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <!-- enable latex -->
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">在 EC2 中開啟 Docker Swarm 群集</h1>
    <p class="post-meta">
    <time class="dt-published" datetime="2022-06-22T12:38:00+00:00" itemprop="datePublished">Jun 22, 2022
      | 👀
      <span class="reading-time" title="Estimated read time">
        
        
                                 6 mins
                                 
      </span>
    </time>
    |
    
      <span class="tag">update</span>
    
      <span class="tag">docker</span>
    
      <span class="tag">docker-swarm</span>
    
      <span class="tag">COSCUP</span>
    </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div class="sidebar"><ul><li><a href="#docker-swarm-introduction">Docker Swarm Introduction</a><ul><li><a href="#structure">Structure</a></li><li><a href="#scalability--availability">Scalability &amp; Availability</a></li><li><a href="#service-vs-task">Service vs Task</a></li><li><a href="#stack-vs-compose">Stack vs Compose</a></li></ul></li><li><a href="#swarm-mode-implementation">Swarm Mode Implementation</a><ul><li><a href="#ec2-特殊設定">EC2 特殊設定</a></li><li><a href="#操作步驟">操作步驟</a></li></ul></li></ul></div>
    <h2 id="docker-swarm-introduction">Docker Swarm Introduction</h2>

<ul>
  <li>Ref: <a href="https://www.youtube.com/watch?v=_riEfxHoUh0&amp;list=PLzZ2RIhyht-PTxy-l5H4iwtCPmNHJu8wD&amp;index=29">(32) Docker Swarm Introduction - Video 28 - YouTube</a></li>
</ul>

<h3 id="structure">Structure</h3>

<p><img src="/assets/img/swarm.png" alt="Work.jpg" /></p>

<h3 id="scalability--availability">Scalability &amp; Availability</h3>

<p><strong>Differences/Definitions of Scalability &amp; Availability</strong></p>

<ul>
  <li>Scalability: 當流量變大/變小時，系統中的 server 數可以橫向擴展或縮減</li>
  <li>Availability: 當部分的機器無法運作時，能夠確保服務不被中斷（自動開啟新的 instance）</li>
  <li>Docker Swarm Features
    <ol>
      <li>Scalability：自動在空間足夠的 worker 上開啟新的 container</li>
      <li>Availability：以更新 app、降低 downtime 為例
        <ol>
          <li>當需要更新 app 版本時，可以讓 load balancer 自動 route 到新版 app 上</li>
          <li>漸進式取代所有舊版的 app container</li>
        </ol>
      </li>
    </ol>
  </li>
</ul>

<h3 id="service-vs-task">Service vs Task</h3>
<p>根據 document 的寫法，service 與 task 的差別如下圖：
<img src="https://docs.docker.com/engine/swarm/images/services-diagram.png" alt="https://docs.docker.com/engine/swarm/images/services-diagram.png" />
兩者的區別在於，service 是由 manager 控管的 application，而 task 則是根據 manager 的控制、各個 worker 被指派的任務。</p>

<h3 id="stack-vs-compose">Stack vs Compose</h3>

<p>基本上 stack 可以視為升級版的 compose，並且 stack 的設定檔也可以拿 docker-compose file 來執行（只要是 yml 都行）</p>

<h2 id="swarm-mode-implementation">Swarm Mode Implementation</h2>

<ul>
  <li>Ref: <a href="https://zhuanlan.zhihu.com/p/79694462">Swarm与Docker的整合——Swarm mode - 知乎 (zhihu.com)</a></li>
  <li><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/#open-protocols-and-ports-between-the-hosts">Getting started with swarm mode, Docker Documentation</a> → port prerequistive to set up security group</li>
  <li>Run docker daemon on EC2(amazon linux): <a href="https://phoenixnap.com/kb/cannot-connect-to-the-docker-daemon-error#:~:text=Method%202%3A%20Assign%20Ownership%20to%20the%20Docker%20Unix%20Socket">Method 2: Assign Ownership to the Docker Unix Socket</a></li>
</ul>

<h3 id="ec2-特殊設定">EC2 特殊設定</h3>

<ul>
  <li>SSM53: session manager <a href="/2022/06/05/aws-ssh.html">參考前一篇文章</a></li>
  <li>Security Group Inbounds
    <ul>
      <li>Allow TCP port 6000-9000 from my IP</li>
      <li>Allow all TCP inbound from same security group，好處是可以不用特別設定 <a href="https://docs.docker.com/engine/swarm/swarm-tutorial/#open-protocols-and-ports-between-the-hosts">docker swarm 指定的傳輸 port</a></li>
    </ul>
  </li>
</ul>

<h3 id="操作步驟">操作步驟</h3>

<ol>
  <li>開三台 EC2，其中一台作為 manager、另外兩台作為 worker</li>
  <li>安裝 docker 並執行 docker daemon
    <ol>
      <li>開啟 docker engine：<code class="language-plaintext highlighter-rouge">sudo service docker start</code></li>
      <li><code class="language-plaintext highlighter-rouge">sudo chown ec2-user:docker /var/run/docker.sock</code> （<code class="language-plaintext highlighter-rouge">ec2-user</code>為 user-name，給予 ec2-user docker engine 的 ownership）</li>
    </ol>
  </li>
</ol>

<p><strong>Manager</strong></p>

<ol>
  <li>開啟一個 swarm、並將所在的機器指定為 manager：<code class="language-plaintext highlighter-rouge">docker swarm init --advertise-addr [manager-ip]</code>
    <ol>
      <li>終端機會回傳如何將 worker 加入 swarm 的指令：<code class="language-plaintext highlighter-rouge">docker swarm join --token [token] [manager-ip]:2377</code></li>
      <li>如果遺忘加入的指令的話，可以在 manager 下這個指令來找回：<code class="language-plaintext highlighter-rouge">docker swarm join-token worker</code></li>
    </ol>
  </li>
</ol>

<p><strong>Worker</strong></p>

<ol>
  <li>用生成的指令來加入剛剛設定的 swarm：<code class="language-plaintext highlighter-rouge">docker swarm join --token [token] [manager-ip]:2377</code></li>
</ol>

<p><strong>檢查 swarm 元件</strong></p>

<ol>
  <li>可以在 manager 下 <code class="language-plaintext highlighter-rouge">docker node ls</code> 檢查 swarm 內的節點是否符合預期</li>
</ol>

  </div>

  
  
    <script src="https://utteranc.es/client.js"
            repo=jqlynchien713/jqlynchien713.github.io
            issue-term=pathname
            label=Comments
            theme=github-light
            crossorigin= "anonymous"
            async>
    </script>
  

<a class="u-url" href="/2022/06/22/docker-swarm-intro.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Jacquelyn&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jacquelyn&#39;s Blog</li><li><a class="u-email" href="mailto:jqlynchien713@gmail.com">jqlynchien713@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-3"><ul class="social-media-list"><li><a href="https://github.com/jqlynchien713"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jqlynchien713</span></a></li></ul>
</div>

      <div class="footer-col footer-col-2">
        <p>ʕ •ᴥ•ʔ</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
